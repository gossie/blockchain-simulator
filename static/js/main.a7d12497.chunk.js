(this.webpackJsonpblockchain=this.webpackJsonpblockchain||[]).push([[0],{106:function(e,t,n){e.exports=n(199)},111:function(e,t,n){},112:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){},115:function(e,t,n){},116:function(e,t,n){},120:function(e,t){},122:function(e,t){},156:function(e,t){},157:function(e,t){},199:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),o=n(99),i=n.n(o),r=(n(111),n(7)),s=(n(112),n(113),function(e){var t=Object(a.useState)("I am waiting!"),n=Object(r.a)(t,2),o=n[0],i=n[1],s=Object(a.useState)(""),u=Object(r.a)(s,2),l=u[0],b=u[1],h=Object(a.useState)(!1),f=Object(r.a)(h,2),k=f[0],m=f[1];Object(a.useEffect)((function(){var t=e.miner.observeProofOfWorkSearch().subscribe((function(e){return b(e)}));return function(){return t.unsubscribe()}}));return c.a.createElement("div",{className:"miner"},c.a.createElement("h2",{className:"title"},"Miner"),c.a.createElement("div",null,o," ",l),c.a.createElement("div",null,c.a.createElement("button",{className:"button is-link "+(k?"is-loading":""),onClick:function(){m(!0),i("I am mining!"),e.miner.startMining()}},"Start"),c.a.createElement("button",{className:"button is-link",onClick:function(){m(!1),i("I am waiting!"),e.miner.pauseMining()}},"Pause")))}),u=n(44),l=function(e){return c.a.createElement("div",null,"Transfer ",e.transaction.amount," from ",e.transaction.from," to ",e.transaction.to,".")},b=n(15),h=n(16),f=function(){function e(t,n,a){Object(b.a)(this,e),this._from=t,this._to=n,this._amount=a}return Object(h.a)(e,[{key:"from",get:function(){return this._from}},{key:"to",get:function(){return this._to}},{key:"amount",get:function(){return this._amount}}]),e}(),k=(n(114),function(e){var t=Object(a.useState)(""),n=Object(r.a)(t,2),o=n[0],i=n[1],s=Object(a.useState)(""),b=Object(r.a)(s,2),h=b[0],k=b[1],m=Object(a.useState)(1),p=Object(r.a)(m,2),v=p[0],O=p[1],d=Object(a.useState)(Object(u.a)(e.blockchain.openTransactions)),_=Object(r.a)(d,2),j=_[0],E=_[1];Object(a.useEffect)((function(){var t=e.blockchain.observeNewBlock().subscribe((function(){return E(Object(u.a)(e.blockchain.openTransactions))}));return function(){return t.unsubscribe()}}),[e.blockchain]);var g=j.map((function(e,t){return c.a.createElement(l,{key:t,transaction:e})}));return c.a.createElement("div",null,c.a.createElement("div",null,c.a.createElement("h2",{className:"title"},"Transactions"),c.a.createElement("div",{className:"transaction-form"},"Transfer ",c.a.createElement("input",{"data-testid":"amount",className:"input",type:"text",value:v,onChange:function(e){var t=parseInt(e.target.value);O(t||1)}}),"from ",c.a.createElement("input",{"data-testid":"from",className:"input",type:"text",value:o,onChange:function(e){return i(e.target.value)}}),"to ",c.a.createElement("input",{"data-testid":"to",className:"input",type:"text",value:h,onChange:function(e){return k(e.target.value)}}),c.a.createElement("button",{"data-testid":"add",className:"button is-link",onClick:function(){var t=new f(o,h,v);e.blockchain.addOpenTransaction(t),E((function(e){return[].concat(Object(u.a)(e),[t])}))}},"Add"))),c.a.createElement("div",null,"Currently there are ",g.length," open transactions."),c.a.createElement("div",null,g))}),m=(n(115),function(e){var t=e.block.transactions.map((function(e){return"Transfered ".concat(e.amount," from ").concat(e.from," to ").concat(e.to)})).map((function(e){return c.a.createElement("li",null,e)}));return c.a.createElement("div",{className:"block box"},t.length>0&&c.a.createElement("div",null,c.a.createElement("b",null,"Transactions:")," ",c.a.createElement("ul",null,t)),e.block.previousHash.length>0&&c.a.createElement("div",null,c.a.createElement("b",null,"Previous hash:")," ",e.block.previousHash),c.a.createElement("b",null,"Hash:")," ",e.block.hash,c.a.createElement("br",null),c.a.createElement("b",null,"Proof of work:")," ",e.block.proofOfWork)}),p=(n(116),function(e){var t=function(e){return e.map((function(e,t){return c.a.createElement(m,{key:t,block:e})})).reverse()},n=Object(a.useState)(t(e.blockchain.blocks)),o=Object(r.a)(n,2),i=o[0],s=o[1];return Object(a.useEffect)((function(){var n=e.blockchain.observeNewBlock().subscribe((function(){return s(t(e.blockchain.blocks))}));return function(){return n.unsubscribe()}}),[e.blockchain]),c.a.createElement("div",{className:"blockchain"},c.a.createElement("h2",{className:"title"},"Blockchain"),i)}),v=n(102),O=n(100),d=n(103),_=n(201),j=(n(117),n(25)),E=function(){function e(t,n,a){Object(b.a)(this,e),this._transactions=t,this._previousHash=n,this._proofOfWork=a,this._hash=void 0;var c=t.map((function(e){return"".concat(e.from).concat(e.to).concat(e.amount)})).join();this._hash=Object(j.createHash)("sha256").update(c).update("".concat(n)).update("".concat(a)).digest("hex")}return Object(h.a)(e,[{key:"transactions",get:function(){return this._transactions}},{key:"previousHash",get:function(){return this._previousHash}},{key:"hash",get:function(){return this._hash}},{key:"proofOfWork",get:function(){return this._proofOfWork}}]),e}(),g=n(101),N=function(){function e(){Object(b.a)(this,e),this._blockSubject=void 0,this._blocks=[],this._openTransactions=[];var t=new E([],"",123);this._blocks.push(t),this._blockSubject=new _.a(t)}return Object(h.a)(e,[{key:"observeNewBlock",value:function(){return this._blockSubject.asObservable()}},{key:"addOpenTransaction",value:function(e){this._openTransactions.push(e)}},{key:"addBlock",value:function(t){var n=this;console.debug("blockchain received a new proof of work",t);var a=new E(this._openTransactions.splice(0,e.MAX_BLOCK_SIZE),this.top.hash,t);console.debug("blockchain created a new block",a),this._blocks.push(a);var c=this._blocks.pipe(new S((function(e,t){return n.checkBlocks(e,t)})));console.debug("blockchain was checked for consistency",c),c?(console.debug("blockchain propagates block"),this._blockSubject.next(a)):(console.debug("blockchain removes block"),this._blocks.pop())}},{key:"checkBlocks",value:function(t,n){return Object(j.createHash)("sha256").update("".concat(t.proofOfWork).concat(n.proofOfWork).concat(t.hash)).digest("hex").startsWith(e.PROOF_OF_WORK_CONSTRAINT)}},{key:"top",get:function(){return this._blocks[this._blocks.length-1]}},{key:"blocks",get:function(){return this._blocks}},{key:"openTransactions",get:function(){return this._openTransactions}}]),e}();N.PROOF_OF_WORK_CONSTRAINT="00",N.MAX_BLOCK_SIZE=5;var S=function(e){function t(e){var n;return Object(b.a)(this,t),(n=Object(v.a)(this,Object(O.a)(t).call(this))).reducer=e,n._lastBlock=void 0,n}return Object(d.a)(t,e),Object(h.a)(t,[{key:"getFallbackValue",value:function(){return!0}},{key:"perform",value:function(e){if(this._lastBlock){var t=this.reducer(this._lastBlock,e),n={value:t,done:!t};return this._lastBlock=e,n}return this._lastBlock=e,{value:!1,done:!1}}}]),t}(g.TerminalOperator);var y=n(104),w=n(202),W=n(204),T=n(203),B=function(){function e(t){var n=this;Object(b.a)(this,e),this._blockchain=t,this._proofOfWorkSubject=new y.a,this._miningSubscription=void 0,this._blockSubscription=void 0,this._top=void 0,this._proofOfWork=0,this._top=t.top,this._blockSubscription=t.observeNewBlock().subscribe((function(e){n._top=e,n._proofOfWork=0}))}return Object(h.a)(e,[{key:"observeProofOfWorkSearch",value:function(){return this._proofOfWorkSubject.asObservable()}},{key:"startMining",value:function(){var t=this;this._miningSubscription=Object(w.a)(e.MINING_TIMEOUT).pipe(Object(T.a)((function(){return 0===t._proofOfWork?Object(W.a)(3e3):Object(W.a)(0)}))).subscribe((function(){return t.mine()}))}},{key:"pauseMining",value:function(){var e;null===(e=this._miningSubscription)||void 0===e||e.unsubscribe()}},{key:"tearDown",value:function(){this._miningSubscription&&this._miningSubscription.unsubscribe(),this._blockSubscription.unsubscribe()}},{key:"mine",value:function(){this._proofOfWorkSubject.next("Currently checking ".concat(this._proofOfWork)),Object(j.createHash)("sha256").update("".concat(this._top.proofOfWork).concat(this._proofOfWork).concat(this._top.hash)).digest("hex").startsWith(N.PROOF_OF_WORK_CONSTRAINT)?(this._proofOfWorkSubject.next("Wohoo! ".concat(this._proofOfWork," worked. I am creating a new block.")),this._blockchain.addBlock(this._proofOfWork)):++this._proofOfWork}}]),e}();B.MINING_TIMEOUT=50;var I=function(){var e=Object(a.useState)(new N),t=Object(r.a)(e,2),n=t[0],o=(t[1],Object(a.useState)(new B(n))),i=Object(r.a)(o,2),u=i[0];i[1];return Object(a.useEffect)((function(){return function(){return u.tearDown()}})),c.a.createElement("div",{className:"tile is-ancestor"},c.a.createElement("div",{className:"tile is-vertical"},c.a.createElement("div",{className:"tile is-parent"},c.a.createElement("div",{className:"tile is-child box"},c.a.createElement("p",null,"This is a simple blockchain simulator. It consists only of one miner that tries to find find blocks."))),c.a.createElement("div",{className:"tile"},c.a.createElement("div",{className:"tile is-parent"},c.a.createElement("div",{className:"tile is-child box"},c.a.createElement(k,{blockchain:n}))),c.a.createElement("div",{className:"tile is-parent is-vertical"},c.a.createElement("div",{className:"tile is-child box"},c.a.createElement(s,{miner:u})),c.a.createElement("div",{className:"tile is-child box"},c.a.createElement(p,{blockchain:n}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(c.a.createElement(I,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[106,1,2]]]);
//# sourceMappingURL=main.a7d12497.chunk.js.map