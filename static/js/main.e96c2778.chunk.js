(this.webpackJsonpblockchain=this.webpackJsonpblockchain||[]).push([[0],{106:function(e,t,n){e.exports=n(199)},111:function(e,t,n){},112:function(e,t,n){},113:function(e,t,n){},114:function(e,t,n){},115:function(e,t,n){},116:function(e,t,n){},119:function(e,t){},121:function(e,t){},155:function(e,t){},156:function(e,t){},199:function(e,t,n){"use strict";n.r(t);var a,c=n(0),o=n.n(c),i=n(99),r=n.n(i),s=(n(111),n(112),n(8)),l=(n(113),n(11)),u=n(12);!function(e){e[e.CheckingBlock=0]="CheckingBlock",e[e.BlockCreated=1]="BlockCreated",e[e.BlockRejected=2]="BlockRejected"}(a||(a={}));var h=function(){function e(t,n){Object(l.a)(this,e),this._eventType=t,this._payload=n}return Object(u.a)(e,[{key:"eventType",get:function(){return this._eventType}},{key:"payload",get:function(){return this._payload}}]),e}(),f=function(e){var t=Object(c.useState)("I am waiting!"),n=Object(s.a)(t,2),i=n[0],r=n[1],l=Object(c.useState)(""),u=Object(s.a)(l,2),h=u[0],f=u[1],b=Object(c.useState)(!1),k=Object(s.a)(b,2),m=k[0],d=k[1],p=Object(c.useState)(e.miner.minedBlocks),v=Object(s.a)(p,2),O=v[0],_=v[1],j=Object(c.useState)(e.miner.rejectedBlocks),E=Object(s.a)(j,2),g=E[0],y=E[1],w=Object(c.useState)("has-text-black"),N=Object(s.a)(w,2),B=N[0],T=N[1];Object(c.useEffect)((function(){var t=e.miner.observeProofOfWorkSearch().subscribe((function(e){switch(e.eventType){case a.CheckingBlock:f("Currently checking ".concat(e.payload)),T("has-text-black");break;case a.BlockCreated:f("Wohoo! It worked. I am creating a new block."),T("has-text-success"),_((function(e){return e+1}));break;case a.BlockRejected:f("Block was not added. Proof of work does not fullfill constraint."),T("has-text-danger"),y((function(e){return e+1}))}}));return function(){return t.unsubscribe()}}));return o.a.createElement("div",{className:"miner"},o.a.createElement("h2",{className:"title"},"Miner ",e.index),o.a.createElement("div",null,i),o.a.createElement("div",{className:B},h),o.a.createElement("div",{className:"mined"},O," blocks were successfully mined."),o.a.createElement("div",{className:"rejected"},g," blocks were rejected."),o.a.createElement("div",null,o.a.createElement("button",{className:"button is-link "+(m?"is-loading":""),onClick:function(){d(!0),r("I am mining!"),e.miner.startMining()}},"Start"),o.a.createElement("button",{className:"button is-link",onClick:function(){d(!1),r("I am waiting!"),e.miner.pauseMining()}},"Pause")))},b=n(37),k=function(e){return o.a.createElement("div",null,"Transfer ",e.transaction.amount," from ",e.transaction.from," to ",e.transaction.to,".")},m=function(){function e(t,n,a){Object(l.a)(this,e),this._from=t,this._to=n,this._amount=a}return Object(u.a)(e,[{key:"from",get:function(){return this._from}},{key:"to",get:function(){return this._to}},{key:"amount",get:function(){return this._amount}}]),e}(),d=(n(114),["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"]),p=function(e){var t=Object(c.useState)(""),n=Object(s.a)(t,2),a=n[0],i=n[1],r=Object(c.useState)(""),l=Object(s.a)(r,2),u=l[0],h=l[1],f=Object(c.useState)(1),p=Object(s.a)(f,2),v=p[0],O=p[1],_=Object(c.useState)(Object(b.a)(e.blockchain.openTransactions)),j=Object(s.a)(_,2),E=j[0],g=j[1];Object(c.useEffect)((function(){var t=e.blockchain.observeNewBlock().subscribe((function(){return g(Object(b.a)(e.blockchain.openTransactions))}));return function(){return t.unsubscribe()}}),[e.blockchain]);var y=E.map((function(e,t){return o.a.createElement(k,{key:t,transaction:e})}));return o.a.createElement("div",null,o.a.createElement("div",null,o.a.createElement("h2",{className:"title"},"Open transactions"),o.a.createElement("div",{className:"row"},o.a.createElement("button",{className:"button is-link",onClick:function(){for(var t=function(t){var n=d[Math.round(25*Math.random())],a=d[Math.round(25*Math.random())],c=new m(n,a,Math.round(12*Math.random())+1);e.blockchain.addOpenTransaction(c),g((function(e){return[].concat(Object(b.a)(e),[c])}))},n=0;n<15;n++)t()}},"Create 15 random transactions")),o.a.createElement("div",{className:"transaction-form row"},"Transfer ",o.a.createElement("input",{"data-testid":"amount",className:"input",type:"text",value:v,onChange:function(e){var t=parseInt(e.target.value);O(t||1)}}),"from ",o.a.createElement("input",{"data-testid":"from",className:"input",type:"text",value:a,onChange:function(e){return i(e.target.value)}}),"to ",o.a.createElement("input",{"data-testid":"to",className:"input",type:"text",value:u,onChange:function(e){return h(e.target.value)}}),o.a.createElement("button",{"data-testid":"add",className:"button is-link",onClick:function(){var t=new m(a,u,v);e.blockchain.addOpenTransaction(t),g((function(e){return[].concat(Object(b.a)(e),[t])}))}},"Add"))),o.a.createElement("div",{className:"row"},"Currently there are ",y.length," open transactions."),o.a.createElement("div",{className:"row"},y))},v=(n(115),function(e){var t=e.block.transactions.map((function(e){return"Transfered ".concat(e.amount," from ").concat(e.from," to ").concat(e.to)})).map((function(e,t){return o.a.createElement("li",{key:t},e)}));return o.a.createElement("div",{className:"block box"},t.length>0&&o.a.createElement("div",null,o.a.createElement("b",null,"Transactions:")," ",o.a.createElement("ul",null,t)),o.a.createElement("b",null,"Proof of work:")," ",e.block.proofOfWork,o.a.createElement("br",null),o.a.createElement("b",null,"Hash:")," ",e.block.hash,o.a.createElement("br",null),e.block.previousHash.length>0&&o.a.createElement("div",null,o.a.createElement("b",null,"Previous hash:")," ",e.block.previousHash))}),O=(n(116),function(e){var t=function(e){return e.map((function(e,t){return o.a.createElement(v,{key:t,block:e})})).reverse()},n=Object(c.useState)(t(e.blockchain.blocks)),a=Object(s.a)(n,2),i=a[0],r=a[1];return Object(c.useEffect)((function(){var n=e.blockchain.observeNewBlock().subscribe((function(){return r(t(e.blockchain.blocks))}));return function(){return n.unsubscribe()}}),[e.blockchain]),o.a.createElement("div",{className:"blockchain"},o.a.createElement("h2",{className:"title"},"Blockchain"),i)}),_=n(102),j=n(100),E=n(103),g=n(201),y=n(101),w=n(25),N=(n(198),function(){function e(t,n,a){Object(l.a)(this,e),this._transactions=t,this._previousHash=n,this._proofOfWork=a,this._hash=void 0;var c=t.map((function(e){return"".concat(e.from).concat(e.to).concat(e.amount)})).join();this._hash=Object(w.createHash)("sha256").update(c).update("".concat(n)).update("".concat(a)).digest("hex")}return Object(u.a)(e,[{key:"transactions",get:function(){return this._transactions}},{key:"previousHash",get:function(){return this._previousHash}},{key:"hash",get:function(){return this._hash}},{key:"proofOfWork",get:function(){return this._proofOfWork}}]),e}()),B=function(){function e(){Object(l.a)(this,e),this._blockSubject=void 0,this._blocks=[],this._openTransactions=[];var t=new N([],"",123);this._blocks.push(t),this._blockSubject=new g.a(t)}return Object(u.a)(e,[{key:"observeNewBlock",value:function(){return this._blockSubject.asObservable()}},{key:"addOpenTransaction",value:function(e){this._openTransactions.push(e)}},{key:"addBlock",value:function(t){var n=this,a=new N(this._openTransactions.splice(0,e.MAX_BLOCK_SIZE),this.top.hash,t);if(this._blocks.push(a),this._blocks.pipe(new T((function(e,t){return n.checkBlocks(e,t)}))))window.setTimeout((function(){return n._blockSubject.next(a)}),5e3);else{var c=this._blocks.pop();if(c){switch(c.transactions.length){case 1:this._openTransactions.unshift(c.transactions[0]);break;case 2:this._openTransactions.unshift(c.transactions[0],c.transactions[1]);break;case 3:this._openTransactions.unshift(c.transactions[0],c.transactions[1],c.transactions[2]);break;case 4:this._openTransactions.unshift(c.transactions[0],c.transactions[1],c.transactions[2],c.transactions[3]);break;case 5:this._openTransactions.unshift(c.transactions[0],c.transactions[1],c.transactions[2],c.transactions[3],c.transactions[4])}throw new Error("Block was not added. Proof of work ".concat(t," does not fullfill constraint."))}}}},{key:"checkBlocks",value:function(t,n){return Object(w.createHash)("sha256").update("".concat(t.proofOfWork).concat(n.proofOfWork).concat(t.hash)).digest("hex").startsWith(e.PROOF_OF_WORK_CONSTRAINT)}},{key:"top",get:function(){return this._blocks[this._blocks.length-1]}},{key:"blocks",get:function(){return this._blocks}},{key:"openTransactions",get:function(){return this._openTransactions}}]),e}();B.PROOF_OF_WORK_CONSTRAINT="00",B.MAX_BLOCK_SIZE=5;var T=function(e){function t(e){var n;return Object(l.a)(this,t),(n=Object(_.a)(this,Object(j.a)(t).call(this))).reducer=e,n._lastBlock=void 0,n}return Object(E.a)(t,e),Object(u.a)(t,[{key:"getFallbackValue",value:function(){return!0}},{key:"perform",value:function(e){if(this._lastBlock){var t=this.reducer(this._lastBlock,e),n={value:t,done:!t};return this._lastBlock=e,n}return this._lastBlock=e,{value:!1,done:!1}}}]),t}(y.TerminalOperator);var S=n(104),W=n(202),I=n(204),C=n(203),x=function(){function e(t){var n=this;Object(l.a)(this,e),this._blockchain=t,this._proofOfWorkSubject=new S.a,this._miningSubscription=void 0,this._blockSubscription=void 0,this._top=void 0,this._proofOfWork=0,this._miningIncrementor=1,this._delay=!1,this._minedBlocks=0,this._rejectedBlocks=0,console.debug("Miner is created"),this._top=t.top,this._blockSubscription=t.observeNewBlock().subscribe((function(e){n._top=e}))}return Object(u.a)(e,[{key:"observeProofOfWorkSearch",value:function(){return this._proofOfWorkSubject.asObservable()}},{key:"startMining",value:function(){var t=this;this._miningSubscription=Object(W.a)(e.MINING_TIMEOUT).pipe(Object(C.a)((function(){return t._delay?Object(I.a)(3e3):Object(I.a)(0)}))).subscribe((function(){return t.mine()}))}},{key:"pauseMining",value:function(){var e;null===(e=this._miningSubscription)||void 0===e||e.unsubscribe()}},{key:"tearDown",value:function(){this._miningSubscription&&this._miningSubscription.unsubscribe(),this._blockSubscription.unsubscribe()}},{key:"mine",value:function(){if(this._delay=!1,this._proofOfWorkSubject.next(new h(a.CheckingBlock,this._proofOfWork)),Object(w.createHash)("sha256").update("".concat(this._top.proofOfWork).concat(this._proofOfWork).concat(this._top.hash)).digest("hex").startsWith(B.PROOF_OF_WORK_CONSTRAINT)){try{this._blockchain.addBlock(this._proofOfWork),this._proofOfWorkSubject.next(new h(a.BlockCreated)),this._proofOfWork=0,this._miningIncrementor*=-1,++this._minedBlocks}catch(e){this._proofOfWorkSubject.next(new h(a.BlockRejected)),this._proofOfWork+=this._miningIncrementor,++this._rejectedBlocks}this._delay=!0}else this._proofOfWork+=this._miningIncrementor}},{key:"minedBlocks",get:function(){return this._minedBlocks}},{key:"rejectedBlocks",get:function(){return this._rejectedBlocks}}]),e}();x.MINING_TIMEOUT=50;var M=function(){var e=new B,t=new x(e),n=new x(e),a=new x(e);return Object(c.useEffect)((function(){return function(){t.tearDown(),n.tearDown(),a.tearDown()}})),o.a.createElement("div",{className:"tile is-ancestor"},o.a.createElement("div",{className:"tile is-vertical"},o.a.createElement("div",{className:"tile is-parent"},o.a.createElement("div",{className:"tile is-child box"},o.a.createElement("p",null,"After reading Daniel van Flymen's article on ",o.a.createElement("a",{href:"https://hackernoon.com/learn-blockchains-by-building-one-117428612f46",target:"_blank",rel:"noopener noreferrer"},"learning blockchains by building one"),", I wrote this blockchain simulator. It currently consists of three miners that try to find blocks. Each miner is trying to find a prrof of work that fulfills this constraint:",o.a.createElement("br",null),o.a.createElement("code",null,"hash(proofOfWorkToCheck + lastProofOfWork + lastHash).startsWith('00')")),o.a.createElement("p",null,"Once a miner found a valid proof of work a block is created. It takes five seconds until the new block is replicated to all miners. This way sometimes blocks are mined, that are rejected by the blockchain."))),o.a.createElement("div",{className:"tile"},o.a.createElement("div",{className:"tile is-parent"},o.a.createElement("div",{className:"tile is-child box"},o.a.createElement(p,{blockchain:e}))),o.a.createElement("div",{className:"tile is-parent is-vertical"},o.a.createElement("div",{className:"tile is-parent box"},o.a.createElement("div",{className:"tile is-child"},o.a.createElement(f,{miner:t,index:1})),o.a.createElement("div",{className:"tile is-child"},o.a.createElement(f,{miner:n,index:2})),o.a.createElement("div",{className:"tile is-child"},o.a.createElement(f,{miner:a,index:3}))),o.a.createElement("div",{className:"tile is-child box"},o.a.createElement(O,{blockchain:e}))))))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(o.a.createElement(M,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[106,1,2]]]);
//# sourceMappingURL=main.e96c2778.chunk.js.map